---
import { BLOG } from '~/config.mjs';
import BlogPost from '~/layouts/BlogPost.astro';
import { fetchPosts } from '~/utils/blog';
import { getCanonical, getPermalink } from '~/utils/permalinks';

export async function getStaticPaths() {
  if (BLOG?.disabled || BLOG?.post?.disabled) return [];
  return (await fetchPosts()).map((post) => ({
    params: {
      blog: post.permalink,
    },
    props: { post },
  }));
}

const { post } = Astro.props;
const url = getCanonical(getPermalink(post.permalink, 'post'));
---

<BlogPost {...post}>
  {
    post.Content ? (
      <>
        {/* @ts-ignore */}
        <post.Content />
      </>
    ) : (
      <Fragment set:html={post.content} />
    )
  }
</BlogPost>
